{
    "version": 8,
    "name": "Procedural Buildings",
    "sources": {
        "procedural-buildings": {
            "type": "vector",
            "url": "mapbox://mapbox-geodata.procedural-buildings-v1",
            "maxzoom": 15,
            "promoteId": ["coalesce", ["get", "building_id"], ["id"]]
        }
    },
    "sprite": "",
    "glyphs": "mapbox://fonts/mapbox/{fontstack}/{range}.pbf",
    "projection": {
        "name": "globe"
    },
    "schema": {
        "colorBuildingHighlight": {
            "default": "hsl(34, 30%, 93%)",
            "type": "color",
            "metadata": {
                "mapbox:title": "Color",
                "mapbox:description": "Set a custom color for building fill extrusion when setting highlight state."
            }
        },
        "colorBuildingSelect": {
            "default": "hsl(214, 82%, 63%)",
            "type": "color",
            "metadata": {
                "mapbox:title": "Color",
                "mapbox:description": "Set a custom color for building fill extrusion when setting select state."
            }
        }
    },
    "featuresets": {
        "buildings": {
            "metadata": {
                "mapbox:title": "Buildings",
                "mapbox:description": "Featureset describing the buildings.",
                "mapbox:states": [
                    {
                        "id": "highlight",
                        "type": "boolean",
                        "doc": "When `true`, the building is highlighted. Use this state to create a temporary effect (e.g. hover).",
                        "importConfigs": ["colorBuildingHighlight"]
                    },
                    {
                        "id": "select",
                        "type": "boolean",
                        "doc": "When `true`, the building is selected. Use this state to create a permanent effect. Note: the `select` state has a higher priority than `highlight`.",
                        "importConfigs": ["colorBuildingSelect"]
                    }
                ],
                "mapbox:properties": [
                    {
                        "name": "group",
                        "type": "string",
                        "doc": "A high-level building group like building-2d, building-3d, etc."
                    }
                ]
            },
            "selectors": [
                {
                    "layer": "procedural-buildings",
                    "properties": {
                        "group": "building-3d"
                    },
                    "featureNamespace": "building-A",
                    "_uniqueFeatureID": true
                }
            ]
        }
    },
    "layers": [
        {
            "id": "procedural-buildings",
            "type": "building",
            "metadata": {
                "mapbox:group": "Buildings, built"
            },
            "source": "procedural-buildings",
            "source-layer": "procedural_buildings",
            "minzoom": 15,
            "slot": "middle",
            "filter": [
                "any",
                [
                    "all",
                    [
                        "==",
                        [
                            "get",
                            "extrude"
                        ],
                        "true"
                    ],
                    [
                        "==",
                        [
                            "get",
                            "underground"
                        ],
                        "false"
                    ],
                    [
                        "any",
                        [
                            "<=",
                            [
                                "get",
                                "distance_to_landmark"
                            ],
                            200
                        ],
                        [
                            "==",
                            [
                                "get",
                                "mbx_commercial"
                            ],
                            true
                        ]
                    ]
                ],
                [
                    "<",
                    [
                        "get",
                        "cross_perc"
                    ],
                    0.5
                ]
            ],
            "layout": {
                "building-flood-light-wall-radius": [
                    "case",
                    [">", ["number", ["get", "height"]], 200],
                    ["/", ["number", ["get", "height"]], 3],
                    0
                ],
                "building-flood-light-ground-radius": [
                    "step",
                    ["number", ["get", "height"]],
                    0,
                    30,
                    ["random", 30, 100, ["id"]]
                ],
                "building-roof-shape": [
                    "case",
                    [
                        "all",
                        [
                            "<=",
                            [
                                "get",
                                "area"
                            ],
                            200
                        ],
                        [
                            ">=",
                            [
                                "get",
                                "height"
                            ],
                            100
                        ]
                    ],
                    "flat",
                    [
                        ">=",
                        [
                            "get",
                            "vertex_count"
                        ],
                        16
                    ],
                    "parapet",
                    [
                        "has",
                        "roof_type"
                    ],
                    [
                        "get",
                        "roof_type"
                    ],
                    "parapet"
                ],
                "building-base": [
                    "get",
                    "min_height"
                ],
                "building-height": [
                    "+",
                    [
                        "get",
                        "height"
                    ],
                    [
                        "random",
                        0.3,
                        1,
                        [
                            "id"
                        ]
                    ]
                ],
                "building-facade": [
                    "all",
                    [
                        ">=",
                        [
                            "get",
                            "area"
                        ],
                        500
                    ],
                    [
                        ">=",
                        [
                            "get",
                            "height"
                        ],
                        5
                    ]
                ],
                "building-facade-floors": [
                    "case",
                    [
                        "<",
                        [
                            "get",
                            "height"
                        ],
                        25
                    ],
                    [
                        "/",
                        [
                            "-",
                            [
                                "*",
                                10,
                                [
                                    "ceil",
                                    [
                                        "/",
                                        [
                                            "get",
                                            "height"
                                        ],
                                        10
                                    ]
                                ]
                            ],
                            [
                                "get",
                                "min_height"
                            ]
                        ],
                        4.5
                    ],
                    [
                        "all",
                        [
                            ">=",
                            [
                                "get",
                                "height"
                            ],
                            25
                        ],
                        [
                            "!=",
                            [
                                "get",
                                "roof_type"
                            ],
                            "parapet"
                        ]
                    ],
                    [
                        "/",
                        [
                            "-",
                            [
                                "*",
                                10,
                                [
                                    "ceil",
                                    [
                                        "/",
                                        [
                                            "get",
                                            "height"
                                        ],
                                        10
                                    ]
                                ]
                            ],
                            [
                                "get",
                                "min_height"
                            ]
                        ],
                        4.5
                    ],
                    [
                        "/",
                        [
                            "-",
                            [
                                "get",
                                "height"
                            ],
                            [
                                "get",
                                "min_height"
                            ]
                        ],
                        [
                            "random",
                            20,
                            30,
                            [
                                "id"
                            ]
                        ]
                    ]
                ],
                "building-facade-window": [
                    "case",
                    [
                        "all",
                        [
                            "<",
                            [
                                "get",
                                "height"
                            ],
                            25
                        ],
                        [
                            "<=",
                            [
                                "get",
                                "area"
                            ],
                            2000
                        ]
                    ],
                    [
                        0.5,
                        0.7
                    ],
                    [
                        "all",
                        [
                            ">=",
                            [
                                "get",
                                "height"
                            ],
                            25
                        ],
                        [
                            "!=",
                            [
                                "get",
                                "roof_type"
                            ],
                            "parapet"
                        ]
                    ],
                    [
                        0.5,
                        0.7
                    ],
                    [
                        [
                            "random",
                            0.8,
                            0.95,
                            [
                                "id"
                            ]
                        ],
                        [
                            "random",
                            0.95,
                            1,
                            [
                                "id"
                            ]
                        ]
                    ]
                ],
                "building-facade-unit-width": [
                    "case",
                    [
                        "all",
                        [
                            "<",
                            [
                                "get",
                                "height"
                            ],
                            25
                        ],
                        [
                            "<=",
                            [
                                "get",
                                "area"
                            ],
                            2000
                        ]
                    ],
                    3,
                    [
                        "all",
                        [
                            "<",
                            [
                                "get",
                                "height"
                            ],
                            25
                        ],
                        [
                            ">",
                            [
                                "get",
                                "area"
                            ],
                            2000
                        ]
                    ],
                    [
                        "random",
                        3,
                        6,
                        [
                            "id"
                        ]
                    ],
                    [
                        "at",
                        [
                            "%",
                            [
                                "to-number",
                                [
                                    "id"
                                ],
                                0
                            ],
                            3
                        ],
                        [
                            8,
                            10,
                            12
                        ]
                    ]
                ]
            },
            "paint": {
                "building-flood-light-intensity": [
                    "interpolate",
                    ["linear"],
                    ["measure-light", "brightness"],
                    0.015,
                    ["match", ["config", "theme"], "monochrome", 0, 0.3],
                    0.026,
                    0
                ],
                "building-flood-light-color": "hsl(30, 79%, 81%)",
                "building-cutoff-fade-range": 0.5,
                "building-facade-emissive-chance": [
                    "interpolate",
                    [
                        "linear"
                    ],
                    [
                        "measure-light",
                        "brightness"
                    ],
                    0.1,
                    0.1,
                    0.4,
                    0
                ],
                "building-emissive-strength": [
                    "case",
                    ["to-boolean", ["feature-state", "select"]],
                    [
                        "interpolate",
                        ["linear"],
                        ["at", 2, ["to-hsla", ["config", "colorBuildingSelect"]]],
                        50,
                        0.6,
                        90,
                        0.4
                    ],
                    ["to-boolean", ["feature-state", "highlight"]],
                    [
                        "interpolate",
                        ["linear"],
                        ["at", 2, ["to-hsla", ["config", "colorBuildingHighlight"]]],
                        50,
                        0.6,
                        90,
                        0.4
                    ],
                    [
                        "match",
                        [
                            "get",
                            "building-part"
                        ],
                        "roof",
                        0.02,
                        "window",
                        [
                            "match",
                            [
                                "config",
                                "lightPreset"
                            ],
                            "day",
                            0,
                            [
                                "random",
                                0,
                                0.2,
                                [
                                    "id"
                                ]
                            ]
                        ],
                        "door",
                        0.5,
                        [
                            "match",
                            [
                                "config",
                                "lightPreset"
                            ],
                            "day",
                            0.6,
                            0
                        ]
                    ]
                ],
                "building-color": [
                    "case",
                    ["to-boolean", ["feature-state", "select"]],
                    ["config", "colorBuildingSelect"],
                    ["to-boolean", ["feature-state", "highlight"]],
                    ["config", "colorBuildingHighlight"],
                    [
                        "match",
                        [
                            "get",
                            "building-part"
                        ],
                        "window",
                        [
                            "hsl",
                            38,
                            5,
                            [
                                "random",
                                90,
                                94,
                                [
                                    "id"
                                ]
                            ]
                        ],
                        "wall",
                        [
                            "case",
                            [
                                "all",
                                [
                                    "has",
                                    "building_id"
                                ],
                                [
                                    ">=",
                                    [
                                        "get",
                                        "height"
                                    ],
                                    25
                                ]
                            ],
                            "hsl(40, 43%, 95%)",
                            [
                                "hsl",
                                40,
                                50,
                                [
                                    "random",
                                    92,
                                    98,
                                    [
                                        "id"
                                    ]
                                ]
                            ]
                        ],
                        "roof",
                        [
                            "case",
                            [
                                "all",
                                [
                                    "<=",
                                    [
                                        "get",
                                        "vertex_count"
                                    ],
                                    16
                                ],
                                [
                                    "<=",
                                    [
                                        "get",
                                        "height"
                                    ],
                                    25
                                ],
                                [
                                    "in",
                                    [
                                        "get",
                                        "roof_type"
                                    ],
                                    [
                                        "literal",
                                        [
                                            "gabled",
                                            "hipped",
                                            "pyramidal"
                                        ]
                                    ]
                                ]
                            ],
                            [
                                "hsl",
                                [
                                    "random",
                                    23,
                                    32,
                                    [
                                        "id"
                                    ]
                                ],
                                50,
                                [
                                    "random",
                                    88,
                                    92,
                                    [
                                        "id"
                                    ]
                                ]
                            ],
                            [
                                "==",
                                [
                                    "get",
                                    "roof_type"
                                ],
                                "skillion"
                            ],
                            "hsl(23, 80%, 97%)",
                            [
                                "interpolate",
                                [
                                    "linear"
                                ],
                                [
                                    "get",
                                    "height"
                                ],
                                0,
                                "hsl(40, 39%, 92%)",
                                200,
                                "hsl(23, 80%, 97%)"
                            ]
                        ],
                        "door",
                        [
                            "hsl",
                            0.0,
                            0.0,
                            100.0
                        ],
                        [
                            "hsl",
                            41,
                            80,
                            96
                        ]
                    ]
                ],
                "building-vertical-scale": [
                    "interpolate",
                    [
                        "linear"
                    ],
                    [
                        "zoom"
                    ],
                    15,
                    0,
                    15.3,
                    1
                ],
                "building-opacity": [
                    "interpolate",
                    [
                        "linear"
                    ],
                    [
                        "zoom"
                    ],
                    15,
                    0.1,
                    15.3,
                    1
                ],
                "building-ambient-occlusion-ground-intensity": 0.1,
                "building-ambient-occlusion-ground-radius": 10,
                "building-ambient-occlusion-ground-attenuation": 1,
                "building-ambient-occlusion-intensity": 0.6
            }
        }
    ]
}