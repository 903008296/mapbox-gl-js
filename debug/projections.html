<!DOCTYPE html>
<html>
<head>
    <title>Mapbox GL JS debug page</title>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <link rel="stylesheet" href="../dist/mapbox-gl.css" />
    <style>
        body { margin: 0; padding: 0; }
        html, body, #map { height: 100%; }
    </style>
</head>

<body>
<div id="map"></div>

<script src="../dist/mapbox-gl-dev.js"></script>
<script type="module">
import {Pane} from 'https://esm.sh/tweakpane@4';
import {getAccessToken} from './access_token_generated.js';

mapboxgl.accessToken = getAccessToken();

const PARAMS = {
    projection: 'globe',
    centerLng: -96,
    centerLat: 37.5,
    parallelLat1: 29.5,
    parallelLat2: 45.5
};

const projections = {
    globe: 'Globe',
    albers: 'Albers USA',
    mercator: 'Mercator',
    equalEarth: 'Equal Earth',
    equirectangular: 'Equirectangular',
    lambertConformalConic: 'Lambert Conformal Conic',
    naturalEarth: 'Natural Earth',
    winkelTripel: 'Winkel Tripel'
};

const map = new mapboxgl.Map({
    container: 'map',
    devtools: true,
    hash: true,
    style: 'mapbox://styles/mapbox/streets-v12',
    zoom: 0,
    center: [0, 1],
    projection: PARAMS['projection']
});

const pane = new Pane();

const projectionBinding = pane.addBinding(PARAMS, 'projection', {
    label: 'Projection',
    view: 'list',
    options: Object.keys(projections).map((projection) => ({text: projections[projection], value: projection}), {})
});

pane.addBlade({view: 'separator'});

pane.addButton({title: 'Next projection'}).on('click', () => {
    const projectionKeys = Object.keys(projections);
    const currentIndex = projectionKeys.indexOf(PARAMS['projection']);
    const nextIndex = (currentIndex + 1) % projectionKeys.length;
    PARAMS['projection'] = projectionKeys[nextIndex];
    projectionBinding.refresh();
});

const centerFolder = window.centerFolder = pane.addFolder({
    title: 'Center',
});

const parallelsFolder = pane.addFolder({
    title: 'Parallels',
});

const centerLatBinding = centerFolder.addBinding(PARAMS, 'centerLat', {
    view: 'slider',
    label: 'Latitude',
    min: -90,
    max: 90
});

const centerLngBinding = centerFolder.addBinding(PARAMS, 'centerLng', {
    view: 'slider',
    label: 'Longitude',
    min: -180,
    max: 180
});

const parallelLat1Binding = parallelsFolder.addBinding(PARAMS, 'parallelLat1', {
    view: 'slider',
    label: 'Southern Latitude',
    min: -90,
    max: 90
});

const parallelLat2Binding = parallelsFolder.addBinding(PARAMS, 'parallelLat2', {
    view: 'slider',
    label: 'Northern Latitude',
    min: -90,
    max: 90
});

centerFolder.hidden = parallelsFolder.hidden = !['albers', 'lambertConformalConic'].includes(PARAMS['projection']);
[projectionBinding, centerLatBinding, centerLngBinding, parallelLat1Binding, parallelLat2Binding].forEach((binding) => {
    binding.on('change', () => {
        const projection = PARAMS['projection'];
        centerFolder.hidden = parallelsFolder.hidden = !['albers', 'lambertConformalConic'].includes(projection);

        map.setProjection({
            name: projection,
            center: [PARAMS['centerLng'], PARAMS['centerLat']],
            parallels: [PARAMS['parallelLat1'], PARAMS['parallelLat2']]
        });
    });
});

</script>
</body>
</html>
